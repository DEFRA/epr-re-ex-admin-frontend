{% extends 'layout.njk' %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-xl">PRN activity</h1>

      {% if error %}
        <div class="govuk-error-summary" data-module="govuk-error-summary">
          <h2 class="govuk-error-summary__title">There is a problem</h2>
          <div class="govuk-error-summary__body">
            <p class="govuk-body">{{ error }}</p>
          </div>
        </div>
      {% endif %}

      {% if prns and prns.length %}
        <p class="govuk-body">{{ prns.length }} PRN{% if prns.length != 1 %}s{% endif %} found</p>

        <a href="/prn-activity/download" class="govuk-button" data-module="govuk-button">
          Download as CSV
        </a>

        {% set tableRows = [] %}
        {% for prn in prns %}
          {% set statusCell = { html: govukTag({ text: prn.status | replace("_", " ") }) } %}

          {% set row = [
            { text: prn.prnNumber },
            statusCell,
            { text: prn.issuedTo },
            { text: prn.tonnage },
            { text: prn.material },
            { text: prn.processToBeUsed },
            { text: prn.isDecemberWaste },
            { text: prn.notes },
            { text: prn.issuedAt },
            { text: prn.issuedByName },
            { text: prn.issuedByPosition },
            { text: prn.accreditationYear },
            { text: prn.organisationName },
            { text: prn.wasteProcessingType }
          ] %}
          {% set tableRows = tableRows.concat([row]) %}
        {% endfor %}

        {{ govukTable({
          captionClasses: "govuk-table__caption--m",
          firstCellIsHeader: true,
          head: [
            { text: "PRN Number" },
            { text: "Status" },
            { text: "Issued To" },
            { text: "Tonnage" },
            { text: "Material" },
            { text: "Process" },
            { text: "December Waste" },
            { text: "Notes" },
            { text: "Issued Date" },
            { text: "Issued By" },
            { text: "Position" },
            { text: "Accreditation Year" },
            { text: "Organisation" },
            { text: "Waste Processing Type" }
          ],
          rows: tableRows
        }) }}

      {% else %}
        {{ govukInsetText({ text: "No PRNs found." }) }}
      {% endif %}
    </div>
  </div>
{% endblock %}
